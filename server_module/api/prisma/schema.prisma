generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Car {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  makeDisplay  String
  modelDisplay String
  plateDisplay String

  makeNormalized  String
  modelNormalized String
  plateNormalized String @unique

  year     Int?
  color    String?
  bodyType String?

  bookings Booking[]
}

model Service {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  name        String
  priceRub    Int
  durationMin Int @default(30)

  bookings Booking[]
}

enum BookingStatus {
  ACTIVE
  CANCELED
  COMPLETED
  PENDING_PAYMENT
}

model Booking {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  dateTime DateTime

  status BookingStatus @default(PENDING_PAYMENT)
  canceledAt DateTime?

  // --- payment flow ---
  paymentDueAt DateTime?
  paidAt       DateTime?

  // --- debug/audit ---
  cancelReason String?

  carId     String
  serviceId String

  car     Car     @relation(fields: [carId], references: [id], onDelete: Cascade)
  service Service @relation(fields: [serviceId], references: [id], onDelete: Cascade)

  @@index([carId])
  @@index([serviceId])
  @@index([dateTime])
  @@index([status])
  @@index([paymentDueAt])
}
